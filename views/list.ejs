<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Task List</title>
    <link rel="stylesheet" href="/styles.css">
  </head>
  <body>
    <%- include('navbar') %>

    <h1 style="text-align:center; margin-top:20px;">Task List</h1>

    <div class="container">
      <% if (tasks.length > 0) { %>
        <table class="task-table">
          <thead>
            <tr>
              <th>#</th>
              <th>Title</th>
              <th>Description</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% tasks.forEach(task => { %>
              <tr>
                <td><%= task.taskNumber %></td>
                <td><%= task.title %></td>
                <td><%= task.description %></td>
                <td>
                  <a href="/update/<%= task._id %>">‚úèÔ∏è Edit</a> |
                  <a href="/delete/<%= task._id %>" onclick="return confirm('Delete this task?')">üóëÔ∏è Delete</a>
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      <% } else { %>
        <p>No tasks yet. <a href="/add">Add one</a></p>
      <% } %>
    </div>

    <hr>

    <!-- Fetch by task number -->
    <div class="container">
      <h2>Fetch Task by Number</h2>
      <input id="taskNumInput" class="input-field" placeholder="Enter Task Number">
      <button onclick="fetchByNumber()">Fetch Task</button>
      <div id="taskResult" class="task-card"></div>
    </div>

    <script>
      async function fetchByNumber() {
        const num = document.getElementById("taskNumInput").value.trim();
        if (!num) return alert("Enter task number");

        try {
          const res = await fetch(`/api/tasks/number/${num}`);
          const data = await res.json();
          const resultDiv = document.getElementById("taskResult");
          if (res.ok) {
            resultDiv.innerHTML = `<h3>${data.title}</h3><p>${data.description}</p>`;
          } else {
            resultDiv.innerHTML = `<p style="color:red;">${data.error}</p>`;
          }
        } catch (err) {
          console.error(err);
        }
      }
    </script>
  </body>
</html>
